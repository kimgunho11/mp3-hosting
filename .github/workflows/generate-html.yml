name: Generate HTML index

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Generate index.html
        run: |
          git fetch
          git pull

          last_commit_time=$(git log -1 --format=%cd --date=format:'%Y-%m-%d %H:%M')

          echo '<!DOCTYPE html><html><head><meta charset="UTF-8"><title>File Index</title>' > index.html
          echo '<style>
            body { font-family: sans-serif; padding: 40px; background: #f5f5f5; color: #111; }
            h1 { color: #444; }
            table { border-collapse: collapse; margin-top: 20px; width: 100%; }
            th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
            th { background-color: #eee; }
            .new { color: green; font-weight: bold; }
          </style></head><body>' >> index.html

          echo "<h1>ğŸ“ íŒŒì¼ ëª©ë¡ (ìë™ ìƒì„±)</h1>" >> index.html
          echo "<table><tr><th>íŒŒì¼ ì´ë¦„</th><th>ì—…ë¡œë“œ ì‹œê°„</th></tr>" >> index.html

          for file in *.mp3 *.gif; do
            if [[ -f "$file" ]]; then
              file_time=$(git log -1 --format="%cd" --date=format:'%Y-%m-%d %H:%M' -- "$file")
              if [[ "$file_time" == "$last_commit_time" ]]; then
                echo "<tr><td><a href=\"$file\" class=\"new\">$file ğŸ”„</a></td><td>$file_time</td></tr>" >> index.html
              else
                echo "<tr><td><a href=\"$file\">$file</a></td><td>$file_time</td></tr>" >> index.html
              fi
            fi
          done

          echo '</table></body></html>' >> index.html

      - name: Commit and push index.html
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          git add index.html
          if ! git diff --cached --quiet; then
            git commit -m "ğŸ”„ Auto-update index.html"
            git push
          else
            echo "âœ… No changes to commit."

