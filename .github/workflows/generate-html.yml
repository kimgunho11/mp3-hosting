name: Generate HTML index

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Generate index.html
      run: |
        echo '<!DOCTYPE html>
        <html>
        <head>
          <meta charset="UTF-8">
          <title>MP3 & GIF Files</title>
          <style>
            body {
              font-family: sans-serif;
              padding: 40px;
              background: #1f1f1f;
              color: #eee;
            }
            table {
              width: 100%;
              border-collapse: collapse;
              margin-top: 20px;
            }
            th, td {
              border: 1px solid #444;
              padding: 10px;
              text-align: left;
            }
            th {
              background-color: #333;
              font-weight: bold;
            }
            .timestamp {
              color: #ccc;
              font-size: 0.9em;
            }
          </style>
        </head>
        <body>
          <h1>üìÅ MP3 & GIF File Index</h1>
          <table>
            <tr>
              <th>File Name</th>
              <th>Added At (KST)</th>
            </tr>' > index.html

        for file in *.mp3 *.gif; do
          if [[ -f "$file" && "$file" != "index.html" ]]; then
            timestamp=$(TZ=Asia/Seoul date "+%Y-%m-%d %H:%M")
            echo "            <tr><td><a href=\"$file\">$file</a></td><td class=\"timestamp\">$timestamp</td></tr>" >> index.html
          fi
        done

        echo '          </table>
        </body>
        </html>' >> index.html

    - name: Commit and push index.html
      run: |
        git config user.name "github-actions"
        git config user.email "github-actions@github.com"
        git add index.html
        git commit -m "üîÑ Auto-update index.html"
        git push
